{"version":3,"sources":["dist"],"names":["EXECUTING","require","STATE_EXECUTING","Result","Collection","emitter","browsers","add","browser","push","emit","remove","index","indexOf","splice","getById","browserId","i","length","id","setAllToExecuting","forEach","state","areAllReady","nonReadyList","isReady","serialize","map","getResults","results","reduce","previous","current","success","lastResult","failed","error","disconnected","exitCode","clearResults","clone","slice","callback","context","Object","defineProperty","get","$inject","module","exports"],"mappings":"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","file":"dest","sourcesContent":["'use strict';\n\nvar EXECUTING = require('./browser').STATE_EXECUTING;\nvar Result = require('./browser_result');\n\nvar Collection = function Collection(emitter, browsers) {\n  browsers = browsers || [];\n\n  this.add = function (browser) {\n    browsers.push(browser);\n    emitter.emit('browsers_change', this);\n  };\n\n  this.remove = function (browser) {\n    var index = browsers.indexOf(browser);\n\n    if (index === -1) {\n      return false;\n    }\n\n    browsers.splice(index, 1);\n    emitter.emit('browsers_change', this);\n\n    return true;\n  };\n\n  this.getById = function (browserId) {\n    for (var i = 0; i < browsers.length; i++) {\n      if (browsers[i].id === browserId) {\n        return browsers[i];\n      }\n    }\n\n    return null;\n  };\n\n  this.setAllToExecuting = function () {\n    browsers.forEach(function (browser) {\n      browser.state = EXECUTING;\n    });\n\n    emitter.emit('browsers_change', this);\n  };\n\n  this.areAllReady = function (nonReadyList) {\n    nonReadyList = nonReadyList || [];\n\n    browsers.forEach(function (browser) {\n      if (!browser.isReady()) {\n        nonReadyList.push(browser);\n      }\n    });\n\n    return nonReadyList.length === 0;\n  };\n\n  this.serialize = function () {\n    return browsers.map(function (browser) {\n      return browser.serialize();\n    });\n  };\n\n  this.getResults = function () {\n    var results = browsers.reduce(function (previous, current) {\n      previous.success += current.lastResult.success;\n      previous.failed += current.lastResult.failed;\n      previous.error = previous.error || current.lastResult.error;\n      previous.disconnected = previous.disconnected || current.lastResult.disconnected;\n      return previous;\n    }, { success: 0, failed: 0, error: false, disconnected: false, exitCode: 0 });\n\n    // compute exit status code\n    results.exitCode = results.failed || results.error || results.disconnected ? 1 : 0;\n\n    return results;\n  };\n\n  // TODO(vojta): can we remove this? (we clear the results per browser in onBrowserStart)\n  this.clearResults = function () {\n    browsers.forEach(function (browser) {\n      browser.lastResult = new Result();\n    });\n  };\n\n  this.clone = function () {\n    return new Collection(emitter, browsers.slice());\n  };\n\n  // Array APIs\n  this.map = function (callback, context) {\n    return browsers.map(callback, context);\n  };\n\n  this.forEach = function (callback, context) {\n    return browsers.forEach(callback, context);\n  };\n\n  // this.length\n  Object.defineProperty(this, 'length', {\n    get: function get() {\n      return browsers.length;\n    }\n  });\n};\nCollection.$inject = ['emitter'];\n\nmodule.exports = Collection;\n//# sourceMappingURL=dist.map\n"]}